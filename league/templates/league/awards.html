{% extends "league/base.html" %}
{% load dict_extras %}

{% block title %}Awards | Xl LIBYAN FANTASY{% endblock %}

{% block content %}

<style>
  .xl-logo{
    width:28px; height:28px;
    object-fit:contain;
    background: rgba(255,255,255,.08);
    padding:4px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.10);
  }
</style>
  <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-2 mb-3">
    <h1 class="m-0">Awards</h1>
    <form method="get" class="d-flex flex-wrap align-items-end gap-2">
      <div>
        <label class="form-label mb-1 small muted">Season</label>
        <select class="form-select form-select-sm" name="season">
          {% for s in seasons %}
            <option value="{{ s.id }}" {% if s.id == active_season.id %}selected{% endif %}>{{ s.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="form-label mb-1 small muted">Competition</label>
        <select class="form-select form-select-sm" name="competition">
          {% for c in competitions %}
            <option value="{{ c.id }}" {% if c.id == active_competition.id %}selected{% endif %}>
              {{ c.name }} ({{ c.get_comp_type_display }})
            </option>
          {% endfor %}
        </select>
      </div>

      <button type="submit" class="xl-btn xl-btn--ghost">Apply</button>
    </form>
  </div>

  {% if blocks %}
    <div class="d-flex flex-column gap-3">
      {% for b in blocks %}
        <div class="xl-card">
          <div class="xl-card__body">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-2">
              <div class="d-flex align-items-center gap-2">
                <span class="xl-chip">{{ active_season.name }}</span>
                <span class="xl-chip">{{ active_competition.name }}</span>
              </div>
              <div class="fw-bold">
                {% if b.division %}{{ b.division.name }}{% else %}General{% endif %}
              </div>
            </div>

            <div class="d-flex flex-column gap-3">
              {% for t in b.types %}
                <div class="border rounded-4 p-3" style="border-color: rgba(255,255,255,.10)!important; background: rgba(255,255,255,.03);">
                  <div class="d-flex align-items-center justify-content-between gap-2 mb-2">
                    <div class="fw-bold">{{ t.name }}</div>
                    {% with items=b.grouped|get_item:t %}
                      {% if items %}<span class="xl-chip">{{ items|length }} winner{{ items|length|pluralize }}</span>{% endif %}
                    {% endwith %}
                  </div>

                  {% with items=b.grouped|get_item:t %}
                    {% if items %}
                      <div class="d-flex flex-column gap-2">
                        {% for a in items %}
                          <a class="text-decoration-none" href="{% if a.player %}{% url 'league:player_detail' a.player.id %}{% elif a.team %}{% url 'league:team_detail' a.team.id %}{% else %}#{% endif %}">
                            <div class="d-flex align-items-start justify-content-between gap-3 p-3 rounded-4" style="border:1px solid rgba(255,255,255,.10); background: rgba(0,0,0,.18);">
                              <div class="d-flex align-items-center gap-3">
                                {% if a.player and a.player.photo %}
                                  <img src="{{ a.player.photo|media_src }}" alt="{{ a.player.name }}" style="width:44px;height:44px;border-radius:50%;object-fit:cover;" />
                                {% elif a.team and a.team.logo %}
                                  <img src="{{ a.team.logo|media_src }}" alt="{{ a.team.name }} logo" class="team-logo--sm team-logo">
                                {% else %}
                                  <div style="width:44px;height:44px;border-radius:50%; background: rgba(255,255,255,.06);"></div>
                                {% endif %}

                                <div>
                                  <div class="fw-bold">
                                    {% if a.player %}{{ a.player.name }}{% else %}{{ a.team.name }}{% endif %}
                                  </div>
                                  <div class="muted small d-flex flex-wrap align-items-center gap-2">
                                    {% if a.team %}
                                      {% if a.team.logo %}
                                        <img src="{{ a.team.logo|media_src }}" alt="{{ a.team.name }} logo" class="team-logo--sm team-logo">
                                      {% endif %}
                                      <span>{{ a.team.name }}</span>
                                    {% endif %}

                                    {% if a.opponent_team or a.opponent_player %}
                                      <span class="xl-chip">vs</span>
                                      {% if a.opponent_player %}<span>{{ a.opponent_player.name }}</span>{% endif %}
                                      {% if a.opponent_team %}<span>({{ a.opponent_team.name }})</span>{% endif %}
                                    {% endif %}
                                  </div>

                                  {% if a.fixture %}
                                    <div class="muted small mt-1">Match: {{ a.fixture.home_team.name }} vs {{ a.fixture.away_team.name }}</div>
                                  {% endif %}
                                  {% if a.note %}
                                    <div class="muted small mt-1">{{ a.note }}</div>
                                  {% endif %}
                                </div>
                              </div>

                              <div class="text-end">
                                <div class="xl-chip">{{ a.awarded_at|date:"Y-m-d" }}</div>
                                <div class="muted small mt-1">{{ a.awarded_at|date:"H:i" }}</div>
                              </div>
                            </div>
                          </a>
                        {% endfor %}
                      </div>
                    {% else %}
                      <div class="muted">No winners yet.</div>
                    {% endif %}
                  {% endwith %}
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="xl-card"><div class="xl-card__body muted">No awards yet.</div></div>
  {% endif %}
{% endblock %}
