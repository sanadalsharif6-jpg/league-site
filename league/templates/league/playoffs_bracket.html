{% extends "league/base.html" %}
{% block title %}{{ stage.name }} | Bracket{% endblock %}
{% block content %}
<div class="xl-hero">
  <div class="xl-hero__inner">
    <div>
      <h1 class="xl-title">{{ stage.name }}</h1>
      <p class="xl-subtitle">{{ stage.scope.competition.name }} · {{ stage.scope.division.name }} · {{ stage.scope.group.name }}</p>
    </div>
    <div class="xl-hero__actions">
      <a class="xl-btn xl-btn--ghost" href="{% url 'league:playoffs' %}">Back</a>
    </div>
  </div>
</div>

<div class="xl-card mt-4">
  <div class="xl-card__body">
    <div class="xl-bracket">
      {% for rd in rounds %}
        <div class="xl-round">
          <div class="xl-round__title">{{ rd.name }}</div>

          {% for tie in rd.ties.all %}
            <div class="xl-tie" style="animation-delay: {{ forloop.counter0|add:1 }}0ms;">
              <div class="xl-tie__leg">
                <div class="xl-tie__teams">
                  <div class="xl-teamline">
                    <span class="xl-team">{{ tie.leg1_fixture.home_team.name }}</span>
                    <span class="xl-badge">H</span>
                  </div>
                  <div class="xl-teamline">
                    <span class="xl-team">{{ tie.leg1_fixture.away_team.name }}</span>
                    <span class="xl-badge">A</span>
                  </div>
                </div>
                <div class="xl-tie__score">
                  {% if tie.leg1_fixture.is_played %}
                    <div class="xl-score">{{ tie.leg1_fixture.home_total_points }} - {{ tie.leg1_fixture.away_total_points }}</div>
                  {% else %}
                    <div class="muted">Leg 1 TBD</div>
                  {% endif %}
                </div>
              </div>

              {% if bracket.two_legs and tie.leg2_fixture %}
                <div class="xl-tie__leg xl-tie__leg--second">
                  <div class="xl-tie__meta muted">Leg 2</div>
                  <div class="xl-tie__score">
                    {% if tie.leg2_fixture.is_played %}
                      <div class="xl-score">{{ tie.leg2_fixture.home_total_points }} - {{ tie.leg2_fixture.away_total_points }}</div>
                    {% else %}
                      <div class="muted">TBD</div>
                    {% endif %}
                  </div>
                  <div class="xl-tie__agg">
                    <span class="xl-chip">Agg</span>
                    <span class="xl-score">{{ tie.aggregate_home_points }} - {{ tie.aggregate_away_points }}</span>
                  </div>
                </div>
              {% endif %}
            </div>
          {% empty %}
            <div class="muted">No ties yet in this round.</div>
          {% endfor %}
        </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}